import{F as e,a,I as l,T as t,b as i,P as s,B as r,M as o}from"./@arco-design-BJ-ThMXq.js";import{a as n}from"./axios-FT5ipKkF.js";import{F as p}from"./form-data-5GMaNMsp.js";import{i as u,_ as d}from"./index-B0Sb-4z8.js";import{M as c}from"./Marketplace-8QyBFxvP.js";import{p as m,t as f,B as v,C as g}from"./ethers-Bs4S-GtA.js";import{e as y,r as b,a as h,m as w,s as _,k as j,j as x,l as T,h as k,n as F,y as N,z as V}from"./@vue-DVdXjGaL.js";import"./resize-observer-polyfill-zrGQmaJP.js";import"./vite-plugin-node-polyfills-Dh68s0dh.js";import"./compute-scroll-into-view-DCNUDwgY.js";import"./b-tween-Bhjdt4nK.js";import"./dayjs-Cc8YkNtQ.js";import"./number-precision-BB5CzNB6.js";import"./scroll-into-view-if-needed-CcisqVa9.js";import"./b-validate-BXhoJxPC.js";import"./vue-router-3lz8Ac5B.js";import"./pinia-c4Tz4aig.js";import"./pinia-plugin-persistedstate-bJzzEmMD.js";import"./@adraffy-Crx4Gj2H.js";const z={class:"flex justify-center w-full place-items-center pt-10"},I={class:"flex flex-col gap-4"},S={key:1,class:"text-green-500"},P={key:2,class:"text-red-500"},q=d(y({name:"ListMyNFT",__name:"SellNFT",setup(d){const y=b(0),q=b(""),M=b(""),U=b(!1),C=b(!1),B=b(null),L=b("vertical"),H=h({name:"",description:"",price:0,image:""}),R=b({minRows:5,maxRows:5}),A=b({span:24,offset:0}),D=async e=>{var a,l,t;const i=e.target,s=null==i?void 0:i.files;if(!s||0===s.length)return;C.value=!0,U.value=!0,q.value="",M.value="",y.value=0;const r=s[0];if(r.size>524288e3)return q.value="error",M.value="Image size should be less than 500 KB",U.value=!1,void(C.value=!1);const u=new p;try{u.append("file",r),u.append("pinataMetadata",JSON.stringify({name:r.name,keyvalue:{type:"nft"}}));const e=await n.post("https://api.pinata.cloud/pinning/pinFileToIPFS",u,{maxBodyLength:524288e3,headers:{"Content-Type":"multipart/form-data; boundary=",pinata_api_key:"b0345bd3da1d82b94910",pinata_secret_api_key:"d953676204aa234a42dbc40f1ad3807079ee59e8619053fcb7ce95e57631ad15"},onUploadProgress(e){e.total&&(y.value=Math.round(100*e.loaded/e.total))}}),a="https://gateway.pinata.cloud/ipfs/".concat(e.data.IpfsHash);H.image=a,q.value="success",o.success("Image uploaded successfully!")}catch(d){C.value=!1,q.value="error",M.value=(null==(l=null==(a=d.response)?void 0:a.data)?void 0:l.error)||"上传失败，请重试",null==(t=B.value)||t.clearValidate("image")}finally{y.value=0,U.value=!1,C.value=!1}},E=b({span:24,offset:0}),J={name:[{required:!0,message:"name is required"}],description:[{required:!0,message:"description is required"}],price:[{required:!0,message:"price is required"},{type:"number",min:.01,message:"price is min than 0.01"}],image:[{required:!0,validator:(e,a,l)=>{u(a)?l("Please upload at least one image"):l()}}]},K=async e=>{var a;M.value="",e.preventDefault();if(!(await B.value.validate())){if(!H.image||u(H.image)||!window.ethereum)return q.value="error",void(M.value="Please fill all the fields!");C.value=!0;try{const e=await(async e=>{try{const a=await n.post("https://api.pinata.cloud/pinning/pinJSONToIPFS",e,{headers:{"Content-Type":"application/json",pinata_api_key:"b0345bd3da1d82b94910",pinata_secret_api_key:"d953676204aa234a42dbc40f1ad3807079ee59e8619053fcb7ce95e57631ad15"}});return"https://gateway.pinata.cloud/ipfs/".concat(a.data.IpfsHash)}catch(a){throw a}})(H),l=m(H.price.toString(),"ether"),t=f(l),i=new v(window.ethereum),s=await i.getSigner(),r=new g(c.address,c.abi,await s),p=await r.getListPrice(),u=await r.createToken(e,t,{value:p.toString()});await u.wait(),o.success("Successfully listed your NFT!"),C.value=!1,null==(a=B.value)||a.clearValidate(),window.location.replace("/")}catch(l){C.value=!1,o.error(l.message||"Listing failed, please try again")}}};return(o,n)=>{const p=l,u=a,d=t,c=i,m=s,f=r,v=e;return x(),w("div",z,[_(v,{model:H,ref_key:"formRef",ref:B,onSubmit:K,size:"lg",layout:L.value,class:"bg-white shadow-md rounded px-8 pt-4 pb-8 mb-4","label-col-props":A.value,"wrapper-col-props":E.value,style:{width:"28.5rem"}},{default:j(()=>[n[4]||(n[4]=T("h3",{className:"text-center text-base font-bold text-purple-500 mb-8 "}," Upload your NFT to the marketplace ",-1)),_(u,{field:"name",label:"NFT Name",rules:J.name,"validate-trigger":"blur",class:"mb-4"},{default:j(()=>[_(p,{modelValue:H.name,"onUpdate:modelValue":n[0]||(n[0]=e=>H.name=e),placeholder:"Axie#4563"},null,8,["modelValue"])]),_:1},8,["rules"]),_(u,{field:"description",label:"NFT Description",rules:J.description,"validate-trigger":"blur",class:"mb-6"},{default:j(()=>[_(d,{modelValue:H.description,"onUpdate:modelValue":n[1]||(n[1]=e=>H.description=e),"auto-size":R.value,placeholder:"Axie Infinity Collection","max-length":100,"allow-clear":"","show-word-limit":""},null,8,["modelValue","auto-size"])]),_:1},8,["rules"]),_(u,{field:"price",label:"Price (in ETH)",rules:J.price,"validate-trigger":"blur",class:"mb-6"},{default:j(()=>[_(c,{modelValue:H.price,"onUpdate:modelValue":n[2]||(n[2]=e=>H.price=e),"default-value":0,mode:"button",step:.01,size:"",min:.01,placeholder:"Min 0.01 ETH"},null,8,["modelValue"])]),_:1},8,["rules"]),_(u,{field:"image",label:"Upload Image (<500 KB)","validate-trigger":"input",class:"mb-6"},{default:j(()=>[T("div",I,[T("input",{type:"file",class:"flex w-full",onChange:D,placeholder:"Upload your NFT image"},null,32),U.value?(x(),k(m,{key:0,size:"large",percent:y.value/100,style:{width:"100%"}},{text:j(e=>[N("进度 "+V(100*e.percent)+"%",1)]),_:1},8,["percent"])):F("",!0),"success"===q.value&&U.value?(x(),w("p",S," 上传成功！ ")):F("",!0),"error"===q.value&&M.value?(x(),w("p",P,V(M.value),1)):F("",!0)])]),_:1}),_(u,null,{default:j(()=>[_(f,{type:"primary",onClick:K,disabled:C.value,size:"large",style:{width:"100%"}},{default:j(()=>[...n[3]||(n[3]=[N(" List NFT ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model","layout","label-col-props","wrapper-col-props"])])}}}),[["__scopeId","data-v-9669fcbd"]]);export{q as default};
